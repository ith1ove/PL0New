# PL0编译器实数类型扩展说明

## 扩展概述
本次扩展为PL0编译器添加了完整的实数类型支持，包括实数常量、实数变量、实数运算和实数输入输出操作。

## 主要修改内容

### 1. 符号系统扩展
- 添加了新的符号类型：
  - `REALSYM`: 实数类型关键字 'real'
  - `REALNUMBER`: 实数常量
  - `WRITEREALNUM`: 实数输出函数 'writereal'
  - `READREALNUM`: 实数输入函数 'readreal'

### 2. 词法分析器修改
- 扩展数字识别功能，支持带小数点的实数
- 添加全局变量 `REALNUM` 存储解析的实数值
- 在 `GetSym()` 函数中添加实数字面量识别逻辑

### 3. 语法分析器修改
- 扩展 `OBJECTS` 枚举，添加 `REALCONST` 和 `REALVARIABLE`
- 修改 `ConstDeclaration()` 函数支持实数常量声明
- 添加 `RealVarDeclaration()` 函数处理实数变量声明
- 修改 `ENTER()` 函数在符号表中存储实数信息
- 修改 `FACTOR()` 函数处理实数常量和变量
- 修改 `STATEMENT()` 函数支持实数变量赋值
- 修改 `Block()` 函数支持 `real` 类型声明

### 4. 虚拟机扩展
- 添加实数相关的操作码：
  - 操作码 22: 实数输出 (将放大1000倍的整数还原为实数输出)
  - 操作码 23: 实数输入 (将输入的实数放大1000倍存储为整数)
- 实数运算复用现有的整数运算指令

### 5. 关键字系统扩展
- 添加关键字 'real', 'readreal', 'writereal'
- 更新关键字数组 `KWORD` 和符号数组 `WSYM`
- 更新常量 `NORW` (关键字数量) 和 `SYMNUM` (符号数量)

## 实现策略

### 实数存储方案
由于PL0虚拟机原本只支持整数栈，本实现采用定点数方案：
- 所有实数在内部以整数形式存储（放大1000倍）
- 输入时：实数 × 1000 → 整数存储
- 输出时：整数 ÷ 1000 → 实数显示
- 运算时：直接使用整数运算指令

### 类型兼容性
- 实数可以与整数进行运算
- 实数常量支持小数点表示法
- 实数变量支持所有算术运算符

## 语法扩展

### 新增语法规则
```
<程序> ::= program <标识符>; <分程序>.
<分程序> ::= [<常量说明部分>][<变量说明部分>][<实数变量说明部分>][<过程说明部分>]<语句>
<实数变量说明部分> ::= real <标识符>{,<标识符>};
<实数常量> ::= [+|-]<数字>[.<数字>]
<语句> ::= ... | readreal(<标识符>) | writereal(<表达式>)
```

### 使用示例
```pascal
program test;
const pi = 3.14159;
real radius, area;
begin
    readreal(radius);
    area := pi * radius * radius;
    writereal(area)
end.
```

## 测试用例

### EX15.PL0 - 完整功能测试
- 实数常量定义（π、e）
- 实数变量声明和使用
- 实数输入输出操作
- 圆形和三角形计算
- 实数四则运算演示

### EX15_SIMPLE.PL0 - 基本功能测试
- 简化的实数操作测试
- 基本的加法和乘法运算
- 实数常量和变量混合使用

## 技术细节

### 精度说明
- 内部精度：3位小数（由于使用1000倍放大）
- 输出格式：保留3位小数
- 输入范围：理论上支持 -1000000.000 到 1000000.000

### 限制说明
1. 精度限制：只支持3位小数精度
2. 范围限制：受整数栈范围限制
3. 运算精度：乘除法可能产生精度损失

### 兼容性
- 完全向后兼容原有PL0程序
- 新增的实数类型不影响原有整数和字符类型功能
- 可以在同一程序中混合使用整数、字符和实数类型

## 编译和运行
1. 将测试程序文件放入PL0目录
2. 在编译器界面输入文件名（如 EX15）
3. 点击RUN按钮编译并运行
4. 按提示输入实数值进行测试

## 扩展完成标志
- ✅ 词法分析支持实数字面量
- ✅ 语法分析支持实数类型声明
- ✅ 符号表支持实数符号存储
- ✅ 代码生成支持实数运算
- ✅ 虚拟机支持实数输入输出
- ✅ 创建完整测试用例
- ✅ 向后兼容性保证

本次扩展成功为PL0编译器添加了完整的实数类型支持，为后续更复杂的数值计算程序奠定了基础。
